name: Description Quality Check

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  check-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const isIssue = context.payload.issue != null;
            const body = (context.payload.issue?.body || context.payload.pull_request?.body || '').trim();
            const minLength = isIssue ? 100 : 50;
            
            if (body.length < minLength) {
              const type = isIssue ? 'issue' : 'PR';
              const label = isIssue ? 'needs-more-info' : 'needs-description';
              
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: [label]
              });
              
              const guidance = isIssue
                ? `**For bugs:** Steps to reproduce, expected vs actual behavior, environment.\n**For features:** Use case, motivation, proposed solution.`
                : `**What:** Brief description of changes.\n**Why:** Motivation for this change.\n**Breaking changes:** Any side effects?`;
                        
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: `Thanks for opening this ${type}!\n\nWe noticed the description is quite brief (${body.length} characters). To help us understand your contribution, please add:\n\n${guidance}\n\n*You can edit the description above and we will review it.*`
              });
            }